<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Andes Onboarding Buttons</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #1a1a1a;
            color: white;
        }
        .button-container {
            display: flex;
            gap: 20px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        button {
            padding: 15px 30px;
            border: 2px solid #25d366;
            background: transparent;
            color: #25d366;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        button:hover {
            background: #25d366;
            color: black;
        }
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        .loading {
            opacity: 0.8;
        }
        .success {
            background: #25d366 !important;
            color: black !important;
        }
        .error {
            background: #ef4444 !important;
            color: white !important;
        }
        .log {
            background: #2a2a2a;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            font-family: monospace;
            font-size: 14px;
            max-height: 400px;
            overflow-y: auto;
        }
        .log-entry {
            margin: 5px 0;
            padding: 5px;
            border-left: 3px solid #25d366;
            padding-left: 10px;
        }
        .log-error {
            border-left-color: #ef4444;
            color: #ff6b6b;
        }
        .log-success {
            border-left-color: #25d366;
            color: #51cf66;
        }
        .log-info {
            border-left-color: #339af0;
            color: #74c0fc;
        }
    </style>
</head>
<body>
    <h1>üîç Debug Andes Onboarding Buttons</h1>
    
    <div class="button-container">
        <button 
            id="start-free-btn" 
            data-intent="free" 
            data-language="es"
            class="andes-onboarding-btn">
            üèÉ‚Äç‚ôÇÔ∏è <span class="btn-text">Comenzar Gratis</span>
        </button>
        
        <button 
            id="start-premium-btn" 
            data-intent="premium" 
            data-language="es"
            class="andes-onboarding-btn premium-btn">
            üíé <span class="btn-text">Comenzar Premium</span>
        </button>
    </div>

    <div class="button-container">
        <button onclick="testAPI('free', 'es')">Test Free API</button>
        <button onclick="testAPI('premium', 'es')">Test Premium API</button>
        <button onclick="clearLog()">Clear Log</button>
    </div>

    <div class="log" id="log">
        <div class="log-entry log-info">Debug log initialized...</div>
    </div>

    <script>
        // Configuration
        const CONFIG = {
            apiBaseUrl: 'https://v3-production-2670.up.railway.app',
            debug: true
        };

        // Logging function
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            entry.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`;
            logDiv.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '<div class="log-entry log-info">Debug log cleared...</div>';
        }

        // Test API directly
        async function testAPI(intent, language) {
            log(`üß™ Testing API directly: ${intent} (${language})`, 'info');
            
            try {
                const response = await fetch(`${CONFIG.apiBaseUrl}/onboarding/start`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ intent, language })
                });

                const data = await response.json();
                
                if (data.success) {
                    log(`‚úÖ API Success: ${data.whatsappLink.substring(0, 80)}...`, 'success');
                } else {
                    log(`‚ùå API Error: ${data.error}`, 'error');
                }
            } catch (error) {
                log(`‚ùå API Exception: ${error.message}`, 'error');
            }
        }

        // Main onboarding function
        async function startTraining(intent, button) {
            const language = 'es';
            const originalText = button.innerHTML;
            const loadingText = intent === 'free' 
                ? 'üîÑ Preparando entrenamiento...' 
                : 'üîÑ Activando Premium...';

            log(`üöÄ startTraining called: ${intent}`, 'info');

            try {
                // Update button state
                button.innerHTML = loadingText;
                button.disabled = true;
                button.classList.add('loading');

                log(`üîÑ Button state updated, making API call...`, 'info');

                // Call API
                const response = await fetch(`${CONFIG.apiBaseUrl}/onboarding/start`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ intent, language })
                });

                const data = await response.json();
                log(`üì° API Response: ${JSON.stringify(data)}`, 'info');

                if (data.success && data.whatsappLink) {
                    // Success
                    button.innerHTML = '‚úÖ Redirigiendo a WhatsApp...';
                    button.classList.remove('loading');
                    button.classList.add('success');
                    
                    log(`‚úÖ Success! WhatsApp link: ${data.whatsappLink}`, 'success');
                    
                    // Redirect after delay
                    setTimeout(() => {
                        log(`üîó Redirecting to WhatsApp...`, 'info');
                        window.location.href = data.whatsappLink;
                    }, 2000);

                } else {
                    throw new Error(data.error || 'API returned unsuccessful response');
                }

            } catch (error) {
                log(`‚ùå Error: ${error.message}`, 'error');
                
                // Show error
                button.innerHTML = '‚ùå Error - Intenta de nuevo';
                button.classList.remove('loading');
                button.classList.add('error');
                
                setTimeout(() => {
                    button.innerHTML = originalText;
                    button.disabled = false;
                    button.classList.remove('error');
                }, 3000);
            }
        }

        // Initialize buttons
        function initializeButtons() {
            log('üîç Initializing buttons...', 'info');
            
            const freeBtn = document.getElementById('start-free-btn');
            const premiumBtn = document.getElementById('start-premium-btn');

            log(`Free button found: ${!!freeBtn}`, freeBtn ? 'success' : 'error');
            log(`Premium button found: ${!!premiumBtn}`, premiumBtn ? 'success' : 'error');

            if (freeBtn) {
                freeBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    log('üü¢ Free button clicked!', 'info');
                    startTraining('free', freeBtn);
                });
                log('‚úÖ Free button event listener attached', 'success');
            }

            if (premiumBtn) {
                premiumBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    log('üü° Premium button clicked!', 'info');
                    startTraining('premium', premiumBtn);
                });
                log('‚úÖ Premium button event listener attached', 'success');
            }

            // Also try data attribute method
            const allButtons = document.querySelectorAll('.andes-onboarding-btn');
            log(`Found ${allButtons.length} buttons with .andes-onboarding-btn class`, 'info');
            
            allButtons.forEach((button, index) => {
                const intent = button.getAttribute('data-intent');
                log(`Button ${index}: intent="${intent}", id="${button.id}"`, 'info');
            });
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initializeButtons);
        
        // Also initialize immediately in case DOM is already ready
        if (document.readyState !== 'loading') {
            initializeButtons();
        }
    </script>
</body>
</html>
